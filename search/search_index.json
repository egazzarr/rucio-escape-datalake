{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"Authentication The interaction with the Data Lake requires authentication. It is required to register to the INDIGO Identity and Access Management ( IAM ) service and obtain a X.509 Grid certificate. Follow the instructions in the next sections. ESCAPE IAM registration Navigate here and register for a new account, filling in the required details. After the account has been approved, you will need to log in and add the Escape group to your Groups. To do this, click on the green Join a group botton in the Group requests panel. Enter 'escape' in the group box, adding a brief motivation for the request. You will need to wait in order for this to be approved. X.509 Grid certificate Getting the certificate The following procedure is described for a UK CA/RA, but it is different depending on the country you are located in. Check this link to see what you need. An X.509 grid certificate is sought by first contacting the appropriate certificate authority (CA). This can be done here . Make a note of both the pin and key password, as they will be required later. After your request, you will receive an email asking for further information to be passed to the registration authority (RA). You will need some form of I.D. (e.g. site I.D., driver\u2019s licence, passport) in addition to the pin that was entered in the request to the CA. You will need to pass these to one of the contacts listed in the email, as instructed, who will likely want to arrange a brief video call to confirm your identity against your provided documents. For CERN staff members, the request can be made here , under the \u2018Grid Certificates\u2019 section with \u2018New Grid User Certificate\u2019. Once your identity has been confirmed, you will be emailed a link to download your certificate in .p12 format (PKCS 12). Download the file and store it in a safe place on your computer, where it is always easily accessible. Uploading the certificate Before linking the Grid certificate to your IAM account, you will need to add the certificate to your browser. The procedure you will need to follow varies depending on what browser you are using. For Chrome, this can be done by navigating to chrome://settings/security and following the instructions presented upon selecting Advanced > Manage Certificates > Import. Once the certificate has been imported, log into the ESCAPE IAM and select the green Link certificate botton in the X.509 certificates panel. Changing the certificate Separate out the .p12 object into a separate key (.key) and certificate (.crt). Place the .p12 certificate file in the .globus directory in your home area. If the directory doesn\u2019t exist, create it: $ cd ~ $ mkdir .globus $ cd ~/.globus $ mv /path/to/mycert.p12 . From the .globus directory, execute the following shell commands: $ rm -f client.crt $ rm -f client.key $ openssl pkcs12 -in myCert.p12 -clcerts -nokeys -out client.crt $ openssl pkcs12 -in myCert.p12 -nocerts -nodes -out client.key $ chmod 400 client.crt $ chmod 400 client.key This completes the X.509 certificate set-up for ESCAPE.","title":"Authentication"},{"location":"#authentication","text":"The interaction with the Data Lake requires authentication. It is required to register to the INDIGO Identity and Access Management ( IAM ) service and obtain a X.509 Grid certificate. Follow the instructions in the next sections.","title":"Authentication"},{"location":"#escape-iam-registration","text":"Navigate here and register for a new account, filling in the required details. After the account has been approved, you will need to log in and add the Escape group to your Groups. To do this, click on the green Join a group botton in the Group requests panel. Enter 'escape' in the group box, adding a brief motivation for the request. You will need to wait in order for this to be approved.","title":"ESCAPE IAM registration"},{"location":"#x509-grid-certificate","text":"","title":"X.509 Grid certificate"},{"location":"#getting-the-certificate","text":"The following procedure is described for a UK CA/RA, but it is different depending on the country you are located in. Check this link to see what you need. An X.509 grid certificate is sought by first contacting the appropriate certificate authority (CA). This can be done here . Make a note of both the pin and key password, as they will be required later. After your request, you will receive an email asking for further information to be passed to the registration authority (RA). You will need some form of I.D. (e.g. site I.D., driver\u2019s licence, passport) in addition to the pin that was entered in the request to the CA. You will need to pass these to one of the contacts listed in the email, as instructed, who will likely want to arrange a brief video call to confirm your identity against your provided documents. For CERN staff members, the request can be made here , under the \u2018Grid Certificates\u2019 section with \u2018New Grid User Certificate\u2019. Once your identity has been confirmed, you will be emailed a link to download your certificate in .p12 format (PKCS 12). Download the file and store it in a safe place on your computer, where it is always easily accessible.","title":"Getting the certificate"},{"location":"#uploading-the-certificate","text":"Before linking the Grid certificate to your IAM account, you will need to add the certificate to your browser. The procedure you will need to follow varies depending on what browser you are using. For Chrome, this can be done by navigating to chrome://settings/security and following the instructions presented upon selecting Advanced > Manage Certificates > Import. Once the certificate has been imported, log into the ESCAPE IAM and select the green Link certificate botton in the X.509 certificates panel.","title":"Uploading the certificate"},{"location":"#changing-the-certificate","text":"Separate out the .p12 object into a separate key (.key) and certificate (.crt). Place the .p12 certificate file in the .globus directory in your home area. If the directory doesn\u2019t exist, create it: $ cd ~ $ mkdir .globus $ cd ~/.globus $ mv /path/to/mycert.p12 . From the .globus directory, execute the following shell commands: $ rm -f client.crt $ rm -f client.key $ openssl pkcs12 -in myCert.p12 -clcerts -nokeys -out client.crt $ openssl pkcs12 -in myCert.p12 -nocerts -nodes -out client.key $ chmod 400 client.crt $ chmod 400 client.key This completes the X.509 certificate set-up for ESCAPE.","title":"Changing the certificate"},{"location":"dlaas/","text":"DataLake-as-a-Service for Open Science This service provides the end-user with a Notebook ready-to-be-used and fully integrated with the ESCAPE Data Lake. The service is hosted in https://escape-notebook.cern.ch/ . Authentication Authenticate to IAM. Once you log into the service for the first time, everything will be configured for the OpenID connect by default. You will be able to modify it later and make it persistent. If you don't have an IAM account already, see the authentication section. Server Options Select your server option based on your requirements: Minimal environment: Based on jupyter/scipy-notebook. ROOT environment: If you need to use PyROOT. ROOT environment (Xcache testing): Run the extension in Download mode. Service Usage Once you are inside the service, you will find 5 panels in the left part menu. 1. File Browser: It enables you to work with the files and directories on your sistem. You can find more information in the Jupyerlab documentation . In case you want to upload a file you will need to use this pannel, right click on the file and select \"Upload File(s) to Rucio\". Fill in the form and note that the upload may fail if the destination RSE does not support your authentication method. 2. Running Terminals and Kernels The Running panel in the left sidebar shows a list of all the kernels and terminals currently running across all notebooks, code consoles, and directories. Find more information in the Jupyerlab documentation . 3. Table of Contents This makes it easy to see and navigate the structure of a document. A table of contents is auto-generated in the left sidebar when you have a notebook, markdown, latex or python files opened. The entries are clickable, and scroll the document to the heading in question. Find more information in the Jupyerlab documentation . 4. Rucio extension EXPLORE : This is where you will interact with the DataLake and see all the files (Files, datasets and containers). If you want to use a specific data set, you will need to make it available and add it to your notebook. To do so, click on the folder button to see all the available scopes, select the one that stores your data and complete the search with the absolute DID. The DID syntax has some search flexibility: If you want to see all the files that are inside a specific scope your sintaxis will be SCOPE:* (Example: ATLAS_OD_EDU:* ). In case you want to see all the files that starts with a specific term in a specific scope your sintaxis will be SCOPE:TERM* (Example: ATLAS_OD_EDU:data* ). Finally if you want to see a specific file type the complete DID: SCOPE:NAME (Example: ATLAS_OD_EDU:data_B.GamGam.root ). In case you want to know if there is a replication attached to that file, you need to click on the Availability button and see the rucio web UI. This availability button has some difererent states: Available, Not Available, Collection is empty, Something went wrong... If the state is Not Available you will need to make it Available. Once done you can add it to your notebook. NOTEBOOK : Here you will be able to see all the files you added to the notebook and are ready to be used. CONFIGURATION : There are multiple authentication methods, OpenID connect will be selected by default. Change the authentication method in case you want to use another one. You can select one of the following: - OpenID Connect - X.509 User Certificate - X.509 Proxy Certificate - Username & Password 5. Extension manager You can use this panel in case you want to manage your extensions. This is an option you will mostly not need.","title":"DataLake-as-a-Service for Open Science"},{"location":"dlaas/#datalake-as-a-service-for-open-science","text":"This service provides the end-user with a Notebook ready-to-be-used and fully integrated with the ESCAPE Data Lake. The service is hosted in https://escape-notebook.cern.ch/ .","title":"DataLake-as-a-Service for Open Science"},{"location":"dlaas/#authentication","text":"Authenticate to IAM. Once you log into the service for the first time, everything will be configured for the OpenID connect by default. You will be able to modify it later and make it persistent. If you don't have an IAM account already, see the authentication section.","title":"Authentication"},{"location":"dlaas/#server-options","text":"Select your server option based on your requirements: Minimal environment: Based on jupyter/scipy-notebook. ROOT environment: If you need to use PyROOT. ROOT environment (Xcache testing): Run the extension in Download mode.","title":"Server Options"},{"location":"dlaas/#service-usage","text":"Once you are inside the service, you will find 5 panels in the left part menu.","title":"Service Usage"},{"location":"dlaas/#1-file-browser","text":"It enables you to work with the files and directories on your sistem. You can find more information in the Jupyerlab documentation . In case you want to upload a file you will need to use this pannel, right click on the file and select \"Upload File(s) to Rucio\". Fill in the form and note that the upload may fail if the destination RSE does not support your authentication method.","title":"1. File Browser:"},{"location":"dlaas/#2-running-terminals-and-kernels","text":"The Running panel in the left sidebar shows a list of all the kernels and terminals currently running across all notebooks, code consoles, and directories. Find more information in the Jupyerlab documentation .","title":"2. Running Terminals and Kernels"},{"location":"dlaas/#3-table-of-contents","text":"This makes it easy to see and navigate the structure of a document. A table of contents is auto-generated in the left sidebar when you have a notebook, markdown, latex or python files opened. The entries are clickable, and scroll the document to the heading in question. Find more information in the Jupyerlab documentation .","title":"3. Table of Contents"},{"location":"dlaas/#4-rucio-extension","text":"EXPLORE : This is where you will interact with the DataLake and see all the files (Files, datasets and containers). If you want to use a specific data set, you will need to make it available and add it to your notebook. To do so, click on the folder button to see all the available scopes, select the one that stores your data and complete the search with the absolute DID. The DID syntax has some search flexibility: If you want to see all the files that are inside a specific scope your sintaxis will be SCOPE:* (Example: ATLAS_OD_EDU:* ). In case you want to see all the files that starts with a specific term in a specific scope your sintaxis will be SCOPE:TERM* (Example: ATLAS_OD_EDU:data* ). Finally if you want to see a specific file type the complete DID: SCOPE:NAME (Example: ATLAS_OD_EDU:data_B.GamGam.root ). In case you want to know if there is a replication attached to that file, you need to click on the Availability button and see the rucio web UI. This availability button has some difererent states: Available, Not Available, Collection is empty, Something went wrong... If the state is Not Available you will need to make it Available. Once done you can add it to your notebook. NOTEBOOK : Here you will be able to see all the files you added to the notebook and are ready to be used. CONFIGURATION : There are multiple authentication methods, OpenID connect will be selected by default. Change the authentication method in case you want to use another one. You can select one of the following: - OpenID Connect - X.509 User Certificate - X.509 Proxy Certificate - Username & Password","title":"4. Rucio extension"},{"location":"dlaas/#5-extension-manager","text":"You can use this panel in case you want to manage your extensions. This is an option you will mostly not need.","title":"5. Extension manager"},{"location":"rucio_cli/","text":"Interacting with Rucio CLI Installing the Rucio Client Environment This guide takes a look at how to install the Rucio client environment in three different ways: using Docker, using Singularity, or manually by downloading rucio on your machine. Docker and Singularity mitigate dependency and platform specific issues, and are therefore recommended methods. Docker installation As root Docker needs to be installed following the Docker installation instructions. The procedure will change depending on your operating system. The Docker file will extend the Rucio image and will enable the user to interact with the Data Lake. Further information can be found here . The Docker image for this project can be pulled and tagged with: $ docker pull projectescape/rucio-client:latest $ docker tag projectescape/rucio-client rucio-client Alternatively, to build your own image locally, clone the repository linked above and follow the instructions in the \u2018Build image\u2019 section of the README file. A Rucio instance is fully described by the configuration file /opt/rucio/etc/rucio.cfg. A default for this file is incorporated into the image and supplied to the container when it is run. The values from this default can be partially or fully overridden by either specifying parameters as environment variables or by mounting a bespoke configuration file. Examples of both methods are discussed in the README file. Note that if you are uploading data from the host machine where the Docker container is running, you will need to bind that directory for it to be accessible inside the container. If you are on a HPC cluster, or somewhere where Docker is not usable, try running the container with Singularity . To see whether you pulled or created the Docker image correctly, refer to the Docker documentation . For example, you could run: $ docker ps -a Assuming that your .crt and .key files were generated in the .globus directory, they must now be volume bound to /opt/rucio/etc/ in the container on initialisation. The following command will link the key pairs from the local path to the rucio path: $ docker run -e RUCIO_CFG_ACCOUNT=<myrucioaccount> -v ~/.globus/client.crt:/opt/rucio/etc/client.crt -v ~/.globus/client.key:/opt/rucio/etc/client.key -it --name=rucio-client rucio-client Replace \\< myrucioaccount > with your IAM username. If you encounter permission problems, execute the above command with root permission: $ docker run --user root -e RUCIO_CFG_ACCOUNT=<myrucioaccount> -v ~/.globus/client.crt:/opt/rucio/etc/client.crt -v ~/.globus/client.key:/opt/rucio/etc/client.key -it --name=rucio-client rucio-client As user - no root permissions If you cannot log in as root and you get permission errors, add your user account to the docker group: $ sudo groupadd docker $ sudo gpasswd -a $USER docker Sometimes you will still need to give the /var/run/docker.sock socket and /var/run/docker directory the proper permissions to make it work: $ sudo chown root:docker /var/run/docker.sock $ sudo chown -R root:docker /var/run/docker Place your original .p12 complete certificate in your .globus/ directory and run the following command: $ docker run --user \"$(id -u):$(id -g)\" -e RUCIO_CFG_ACCOUNT=<myrucioaccount> --mount \"type=bind,src=$(pwd)/.globus,dst=/opt/rucio/etc\" --workdir /opt/rucio/etc -it --name=rucio-client rucio-client You will be automatically logged into the Docker container, within a Rucio environment. Once this command brings you inside the docker container, execute the following to allow all the VOMs to take place. $ voms-proxy-init --voms escape --cert opt/rucio/etc/<certificate_name>.p12 General note: To access the rucio-client Docker container in the future, always use this command from the machine where you have Docker installed: $ sudo docker exec -it rucio-client /bin/bash This will log you into the rucio-client container. You can then start Interacting with Rucio through the ESCAPE Data Lake in your new environment. Take a look at some Rucio CLI Quickstart commands to get you familiarised with the main concepts. Singularity installation To use the client in Singularity , first create a Singularity image based on the Docker version $ n Then, create a directory and add your credentials as follows. You will have to replace \\< myrucioaccount > with your IAM username. $ mkdir -p ${HOME}/.rucio $ export RUCIO_CFG_ACCOUNT=<myrucioaccount> $ singularity run -B ${HOME}/.rucio/:/opt/rucio/etc -B ${HOME}/.globus/client.crt:/opt/rucio/etc/client.crt -B ${HOME}/.globus/client.key:/opt/rucio/etc/client.key rucio-cli.simg When running the containerised client, the directory that contains the configuration files should be writable at run time. This means that you have to bind it to the container. Note that this will cause the configuration to be kept between runs, as opposed to running the client in a Docker container which will write a new configuration file at run time (this means that setting the RUCIO_CFG_ACCOUNT variable will only be needed during the first run). If for any reason you want to reset the configuration, just erase the rucio.cfg in the configuration directory (in the example: $HOME/.rucio). Manual installation If you installed the Rucio CLI with Docker, then you will already have the ca-certificates and VOMS installed, but in the manual installation you will have to do it yourself by running the following steps: Certificates Install the necessary certificates as specified in the Rucio client Docker file : $ curl -o /etc/yum.repos.d/EGI-trustanchors.repo http://repository.egi.eu/sw/production/cas/1/current/repo-files/EGI-trustanchors.repo && yum -y update $ yum install -y ca-certificates ca-policy-egi-core fetch-crl Setting up VOMS environment On your local machine or virtual machine, move your certificates from the /opt/rucio/etc/ directory to .globus/, and rename the certificates as specified below. Then install the voms-clients. $ mv client.crt usercert.pem $ mv client.key userkey.pem $ yum install voms-clients After you have done so, follow these instructions under the section \u2018ESCAPE VO configuration\u2019. You will have to create the directory /etc/grid-security/vomsdir/escape and place the LCS file in it (create it with touch), and do the same thing for the VOMSES file if the directory doesn\u2019t already exist. Rucio CLI $ voms-proxy-init --cert .globus/usercert.pem --key .globus/userkey.pem --voms escape Then, install rucio with pip. Get the available pip versions, which will likely be pip3: $ yum info python*-pip $ yum install python3-pip And then run: $ pip3 install rucio-clients By typing in the terminal \u2018rucio whoami\u2019, you should see that the daemon is active. If not, you will be able to locate the rucio.cfg file and change the path to the .pem certificates. If you do not have a rucio.cfg file yet, create the directories /opt/rucio/etc/ and copy and paste the following into a new rucio.cfg file: # Authors: # - Vincent Garonne, <vgaronne@gmail.com>, 2018 [client] rucio_host = https://escape-rucio.cern.ch auth_host = https://escape-rucio-auth.cern.ch ca_cert = /etc/pki/tls/certs/CERN-bundle.pem auth_type = x509 username = password = account = egazzarr client_cert = .globus/usercert.pem client_key = .globus/userkey.pem client_x509_proxy = request_retries = 3 [policy] permission = generic schema = generic lfn2pfn_algorithm_default = hash support = https://github.com/rucio/rucio/issues/ support_rucio = https://github.com/rucio/rucio/issues/ Rucio RESTful APIs Interacting with the client environment can be done through the Docker container, or through the RestAPI. This is a way for developers to be able to integrate any kind of scripts into the environment without the need of installing all the Rucio CLI dependencies. Token generation Now that you have the VOMS in place, you will just need to add your token, which will expire and will be regenerated every hour, to your Rest API request. To get the token, run the command: $ curl -i --key ~/.globus/userkey.pem --cert ~/.globus/usercert.pem -H \"X-Rucio-Account: <myrucioaccount>\" -X GET https://escape-rucio-auth.cern.ch/auth/x509 | sed -n -e 's/^.*X-Rucio-Auth-Token: //p' The \\< myrucioaccount > instance needs to be replaced with your Rucio UI account name, the same as your IAM account (but you can also find it by navigating here and selecting the \u2018Account management\u2019 option under the Admin scroll-down menu). Note: Using curl with the --insecure option allows curl to make insecure connections (i.e. curl does not verify the certificate), bypassing: curl: (60) SSL certificate problem: self signed certificate in certificate chain. Another solution is proposed here . Create a variable by copying the token which has been generated and running in the command line: $ token=\"<your_token>\" Do not forget the \u201c symbol. After the token has been saved, you can run any Rest Api command, for example listing all the available RSEs or all the scopes: $ curl -X GET -H \"X-Rucio-Auth-Token: $token\" https://escape-rucio.cern.ch/rses/ $ curl -X GET -H \"X-Rucio-Auth-Token: $token\" https://escape-rucio.cern.ch/scopes/ Proxy generation The proxy generation with the x509 certificate works in the same way, the only difference is the command to get the toke: $ curl -i --key ~/.globus/userkey.pem --cert ~/.globus/usercert.pem -H \"X-Rucio-Account: <myrucioaccount>\" -X GET https://escape-rucio-auth.cern.ch/auth/x509_proxy | sed -n -e 's/^.*X-Rucio-Auth-Token: //p' Again, using curl with the --insecure option might be useful. Follow the same steps as above to make Rest API requests. To find all the Rucio REST API commands, navigate here .","title":"Interacting with Rucio CLI"},{"location":"rucio_cli/#interacting-with-rucio-cli","text":"","title":"Interacting with Rucio CLI"},{"location":"rucio_cli/#installing-the-rucio-client-environment","text":"This guide takes a look at how to install the Rucio client environment in three different ways: using Docker, using Singularity, or manually by downloading rucio on your machine. Docker and Singularity mitigate dependency and platform specific issues, and are therefore recommended methods.","title":"Installing the Rucio Client Environment"},{"location":"rucio_cli/#docker-installation","text":"","title":"Docker installation"},{"location":"rucio_cli/#as-root","text":"Docker needs to be installed following the Docker installation instructions. The procedure will change depending on your operating system. The Docker file will extend the Rucio image and will enable the user to interact with the Data Lake. Further information can be found here . The Docker image for this project can be pulled and tagged with: $ docker pull projectescape/rucio-client:latest $ docker tag projectescape/rucio-client rucio-client Alternatively, to build your own image locally, clone the repository linked above and follow the instructions in the \u2018Build image\u2019 section of the README file. A Rucio instance is fully described by the configuration file /opt/rucio/etc/rucio.cfg. A default for this file is incorporated into the image and supplied to the container when it is run. The values from this default can be partially or fully overridden by either specifying parameters as environment variables or by mounting a bespoke configuration file. Examples of both methods are discussed in the README file. Note that if you are uploading data from the host machine where the Docker container is running, you will need to bind that directory for it to be accessible inside the container. If you are on a HPC cluster, or somewhere where Docker is not usable, try running the container with Singularity . To see whether you pulled or created the Docker image correctly, refer to the Docker documentation . For example, you could run: $ docker ps -a Assuming that your .crt and .key files were generated in the .globus directory, they must now be volume bound to /opt/rucio/etc/ in the container on initialisation. The following command will link the key pairs from the local path to the rucio path: $ docker run -e RUCIO_CFG_ACCOUNT=<myrucioaccount> -v ~/.globus/client.crt:/opt/rucio/etc/client.crt -v ~/.globus/client.key:/opt/rucio/etc/client.key -it --name=rucio-client rucio-client Replace \\< myrucioaccount > with your IAM username. If you encounter permission problems, execute the above command with root permission: $ docker run --user root -e RUCIO_CFG_ACCOUNT=<myrucioaccount> -v ~/.globus/client.crt:/opt/rucio/etc/client.crt -v ~/.globus/client.key:/opt/rucio/etc/client.key -it --name=rucio-client rucio-client","title":"As root"},{"location":"rucio_cli/#as-user-no-root-permissions","text":"If you cannot log in as root and you get permission errors, add your user account to the docker group: $ sudo groupadd docker $ sudo gpasswd -a $USER docker Sometimes you will still need to give the /var/run/docker.sock socket and /var/run/docker directory the proper permissions to make it work: $ sudo chown root:docker /var/run/docker.sock $ sudo chown -R root:docker /var/run/docker Place your original .p12 complete certificate in your .globus/ directory and run the following command: $ docker run --user \"$(id -u):$(id -g)\" -e RUCIO_CFG_ACCOUNT=<myrucioaccount> --mount \"type=bind,src=$(pwd)/.globus,dst=/opt/rucio/etc\" --workdir /opt/rucio/etc -it --name=rucio-client rucio-client You will be automatically logged into the Docker container, within a Rucio environment. Once this command brings you inside the docker container, execute the following to allow all the VOMs to take place. $ voms-proxy-init --voms escape --cert opt/rucio/etc/<certificate_name>.p12 General note: To access the rucio-client Docker container in the future, always use this command from the machine where you have Docker installed: $ sudo docker exec -it rucio-client /bin/bash This will log you into the rucio-client container. You can then start Interacting with Rucio through the ESCAPE Data Lake in your new environment. Take a look at some Rucio CLI Quickstart commands to get you familiarised with the main concepts.","title":"As user - no root permissions"},{"location":"rucio_cli/#singularity-installation","text":"To use the client in Singularity , first create a Singularity image based on the Docker version $ n Then, create a directory and add your credentials as follows. You will have to replace \\< myrucioaccount > with your IAM username. $ mkdir -p ${HOME}/.rucio $ export RUCIO_CFG_ACCOUNT=<myrucioaccount> $ singularity run -B ${HOME}/.rucio/:/opt/rucio/etc -B ${HOME}/.globus/client.crt:/opt/rucio/etc/client.crt -B ${HOME}/.globus/client.key:/opt/rucio/etc/client.key rucio-cli.simg When running the containerised client, the directory that contains the configuration files should be writable at run time. This means that you have to bind it to the container. Note that this will cause the configuration to be kept between runs, as opposed to running the client in a Docker container which will write a new configuration file at run time (this means that setting the RUCIO_CFG_ACCOUNT variable will only be needed during the first run). If for any reason you want to reset the configuration, just erase the rucio.cfg in the configuration directory (in the example: $HOME/.rucio).","title":"Singularity installation"},{"location":"rucio_cli/#manual-installation","text":"If you installed the Rucio CLI with Docker, then you will already have the ca-certificates and VOMS installed, but in the manual installation you will have to do it yourself by running the following steps:","title":"Manual installation"},{"location":"rucio_cli/#certificates","text":"Install the necessary certificates as specified in the Rucio client Docker file : $ curl -o /etc/yum.repos.d/EGI-trustanchors.repo http://repository.egi.eu/sw/production/cas/1/current/repo-files/EGI-trustanchors.repo && yum -y update $ yum install -y ca-certificates ca-policy-egi-core fetch-crl","title":"Certificates"},{"location":"rucio_cli/#setting-up-voms-environment","text":"On your local machine or virtual machine, move your certificates from the /opt/rucio/etc/ directory to .globus/, and rename the certificates as specified below. Then install the voms-clients. $ mv client.crt usercert.pem $ mv client.key userkey.pem $ yum install voms-clients After you have done so, follow these instructions under the section \u2018ESCAPE VO configuration\u2019. You will have to create the directory /etc/grid-security/vomsdir/escape and place the LCS file in it (create it with touch), and do the same thing for the VOMSES file if the directory doesn\u2019t already exist.","title":"Setting up VOMS environment"},{"location":"rucio_cli/#rucio-cli","text":"$ voms-proxy-init --cert .globus/usercert.pem --key .globus/userkey.pem --voms escape Then, install rucio with pip. Get the available pip versions, which will likely be pip3: $ yum info python*-pip $ yum install python3-pip And then run: $ pip3 install rucio-clients By typing in the terminal \u2018rucio whoami\u2019, you should see that the daemon is active. If not, you will be able to locate the rucio.cfg file and change the path to the .pem certificates. If you do not have a rucio.cfg file yet, create the directories /opt/rucio/etc/ and copy and paste the following into a new rucio.cfg file: # Authors: # - Vincent Garonne, <vgaronne@gmail.com>, 2018 [client] rucio_host = https://escape-rucio.cern.ch auth_host = https://escape-rucio-auth.cern.ch ca_cert = /etc/pki/tls/certs/CERN-bundle.pem auth_type = x509 username = password = account = egazzarr client_cert = .globus/usercert.pem client_key = .globus/userkey.pem client_x509_proxy = request_retries = 3 [policy] permission = generic schema = generic lfn2pfn_algorithm_default = hash support = https://github.com/rucio/rucio/issues/ support_rucio = https://github.com/rucio/rucio/issues/","title":"Rucio CLI"},{"location":"rucio_cli/#rucio-restful-apis","text":"Interacting with the client environment can be done through the Docker container, or through the RestAPI. This is a way for developers to be able to integrate any kind of scripts into the environment without the need of installing all the Rucio CLI dependencies.","title":"Rucio RESTful APIs"},{"location":"rucio_cli/#token-generation","text":"Now that you have the VOMS in place, you will just need to add your token, which will expire and will be regenerated every hour, to your Rest API request. To get the token, run the command: $ curl -i --key ~/.globus/userkey.pem --cert ~/.globus/usercert.pem -H \"X-Rucio-Account: <myrucioaccount>\" -X GET https://escape-rucio-auth.cern.ch/auth/x509 | sed -n -e 's/^.*X-Rucio-Auth-Token: //p' The \\< myrucioaccount > instance needs to be replaced with your Rucio UI account name, the same as your IAM account (but you can also find it by navigating here and selecting the \u2018Account management\u2019 option under the Admin scroll-down menu). Note: Using curl with the --insecure option allows curl to make insecure connections (i.e. curl does not verify the certificate), bypassing: curl: (60) SSL certificate problem: self signed certificate in certificate chain. Another solution is proposed here . Create a variable by copying the token which has been generated and running in the command line: $ token=\"<your_token>\" Do not forget the \u201c symbol. After the token has been saved, you can run any Rest Api command, for example listing all the available RSEs or all the scopes: $ curl -X GET -H \"X-Rucio-Auth-Token: $token\" https://escape-rucio.cern.ch/rses/ $ curl -X GET -H \"X-Rucio-Auth-Token: $token\" https://escape-rucio.cern.ch/scopes/","title":"Token generation"},{"location":"rucio_cli/#proxy-generation","text":"The proxy generation with the x509 certificate works in the same way, the only difference is the command to get the toke: $ curl -i --key ~/.globus/userkey.pem --cert ~/.globus/usercert.pem -H \"X-Rucio-Account: <myrucioaccount>\" -X GET https://escape-rucio-auth.cern.ch/auth/x509_proxy | sed -n -e 's/^.*X-Rucio-Auth-Token: //p' Again, using curl with the --insecure option might be useful. Follow the same steps as above to make Rest API requests. To find all the Rucio REST API commands, navigate here .","title":"Proxy generation"}]}